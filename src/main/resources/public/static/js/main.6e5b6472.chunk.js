(this.webpackJsonpfe=this.webpackJsonpfe||[]).push([[0],{43:function(e,t,n){e.exports=n(56)},56:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(7),o=n.n(c),i=n(11),s=n(9),u=n(26),l=n(10),f=n(85),m=n(89),d=n(91),b=n(90),O=n(92),j=n(37),v=n.n(j),g=window.location,E=g.hostname,p=g.port,h=g.protocol,y="".concat("https:"===h?"wss:":"ws:","//").concat(E,":").concat(["3000","3001","3002","3003"].includes(p)?8080:p),k=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(),c=Object(l.a)(n,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){if(t.current){var e=t.current.getContext("2d");e&&i(e)}}),[]),Object(a.useEffect)((function(){if(o&&e.frame){var t=new Image;t.src=e.frame,t.onload=function(){null===o||void 0===o||o.drawImage(t,0,0,960,540)}}}),[e.frame]),r.a.createElement("canvas",{width:480,height:270,ref:t})};o.a.render(r.a.createElement((function(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),j=Object(l.a)(o,2),g=j[0],E=j[1],p=Object(a.useState)("anonymous"),h=Object(l.a)(p,2),S=h[0],w=h[1],C=Object(a.useState)([]),N=Object(l.a)(C,2),I=N[0],P=N[1],T=Object(a.useState)(),U=Object(l.a)(T,2),M=U[0],A=U[1],F=Object(a.useState)({}),J=Object(l.a)(F,2),L=J[0],V=J[1],x=Object(a.useMemo)((function(){return{shouldReconnect:function(){return!0},reconnectAttempts:10,reconnectInterval:3e3}}),[]),D=["CONNECTING","OPEN","CLOSING","CLOSED"],R=v()("".concat(y,"/socket"),x),G=Object(l.a)(R,3),K=G[0],B=G[1],W=G[2],q=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return K(JSON.stringify(Object(u.a)({},t,{messageType:e})))}),[K]);Object(a.useEffect)((function(){B||"OPEN"!==D[W]||q("LoadMessages")}),[W,B,D,q]),Object(a.useEffect)((function(){if(B){var e=JSON.parse(B.data);switch(console.log(e),e.type){case"Message":c((function(t){return[].concat(Object(s.a)(t),[e])}));break;case"JoiningUser":V((function(t){return Object(u.a)({},t,Object(i.a)({},e.joining,null))}));break;case"LeavingUser":V((function(t){return Object.fromEntries(Object.entries(t).filter((function(t){return Object(l.a)(t,1)[0]!=e.leaving})))}));break;case"SessionVideoFrame":console.log("try store frame",L,L[e.sessionId]),null===L[e.sessionId]&&(console.log("store frame"),V((function(t){return Object(u.a)({},t,Object(i.a)({},e.sessionId,e.frame))})))}}}),[B]),Object(a.useEffect)((function(){"OPEN"!==D[W]||M||navigator.mediaDevices.getUserMedia({audio:!1,video:{noiseSuppression:!0}}).then(A).catch((function(e){"ConstraintNotSatisfiedError"===e.name?P((function(e){return[].concat(Object(s.a)(e),["The resolution x px is not supported by your device."])})):"PermissionDeniedError"===e.name&&P((function(e){return[].concat(Object(s.a)(e),["Permissions have not been granted to use your camera and microphone, you need to allow the page access to your devices in order for the demo to work."])})),P((function(t){return[].concat(Object(s.a)(t),["getUserMedia error: "+e.name])}))}))}),[W,D,M]);return r.a.createElement(f.a,null,r.a.createElement(m.a,{container:!0},r.a.createElement(m.a,{container:!0,item:!0,lg:10},Object.entries(L).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return r.a.createElement(m.a,{item:!0,lg:6},r.a.createElement("div",null,n),r.a.createElement(k,{key:n,frame:a}))}))),r.a.createElement(m.a,{item:!0,lg:2},r.a.createElement("div",null,"Websocket is ",D[W]),r.a.createElement("button",{onClick:function(){var e;null===M||void 0===M||null===(e=M.getVideoTracks()[0])||void 0===e||e.stop()}},"stop"),r.a.createElement("button",{onClick:function(){var e;"OPEN"===D[W]&&M&&"live"===(null===M||void 0===M||null===(e=M.getVideoTracks()[0])||void 0===e?void 0:e.readyState)&&new ImageCapture(M.getVideoTracks()[0]).takePhoto().then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){q("VideoFrame",{frame:t.result,user:"test"})}}))}},"send"),r.a.createElement("ul",null,I.map((function(e){return r.a.createElement("li",null,e)}))),r.a.createElement(d.a,{variant:"filled",label:"User",autoFocus:!0,value:S,onChange:function(e){return w(e.target.value)}}),r.a.createElement(d.a,{variant:"filled",label:"Type your message",autoFocus:!0,value:g,onChange:function(e){return E(e.target.value)},onKeyUp:function(e){e.ctrlKey&&e.key&&g.trim()&&function(e,t){return Promise.resolve(q("AddMessage",{message:e,user:t}))}(g.trim(),S).then((function(){return E("")}))}}),r.a.createElement(b.a,null,n.map((function(e){return r.a.createElement(O.a,{key:e.createdAt},e.createdAt.slice(11,19)," [",e.user,"]: ",e.message)}))))))}),null),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.6e5b6472.chunk.js.map