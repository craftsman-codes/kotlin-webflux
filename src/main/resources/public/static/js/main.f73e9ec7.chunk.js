(this.webpackJsonpfe=this.webpackJsonpfe||[]).push([[0],{47:function(e,t,n){e.exports=n(60)},60:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),i=n(10),u=n(12),s=n(25),l=n(11),d=n(89),f=n(93),m=n(94),b=n(95),O=n(98),v=n(96),g=n(97),j=n(39),E=n.n(j),p=n(99),h=window.location,S=h.hostname,y=h.port,k=h.protocol,I="".concat("https:"===k?"wss:":"ws:","//").concat(S,":").concat(["3000","3001","3002","3003"].includes(y)?8080:y),w=function(e){var t={width:480,height:270},n={width:960,height:540},c=Object(a.useState)(t),o=Object(l.a)(c,2),i=o[0],u=o[1];return r.a.createElement(d.a,{style:{padding:"10px"}},r.a.createElement("img",{alt:e.frame.user,onClick:function(){return u((function(e){return 480===e.width?n:t}))},style:Object(s.a)({},i,{border:"solid lightgrey 2px"}),src:e.frame.frame}),r.a.createElement(f.a,{variant:"subtitle1"},e.frame.user))};o.a.render(r.a.createElement((function(){var e=Object(a.useState)({}),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),d=Object(l.a)(o,2),f=d[0],j=d[1],h=Object(a.useState)(localStorage.getItem("username")||"anonymous"),S=Object(l.a)(h,2),y=S[0],k=S[1],C=Object(a.useState)([]),N=Object(l.a)(C,2),A=N[0],T=N[1],M=Object(a.useState)(),P=Object(l.a)(M,2),x=P[0],F=P[1],U=Object(a.useState)({}),D=Object(l.a)(U,2),J=D[0],L=D[1],R=Object(a.useState)(!1),V=Object(l.a)(R,2),G=V[0],K=V[1],B=function(){var e=localStorage.getItem("sessionId");if(e)return e;var t=Object(p.a)();return localStorage.setItem("sessionId",t),t}(),W=Object(a.useMemo)((function(){return{shouldReconnect:function(){return!0},reconnectAttempts:10,reconnectInterval:3e3}}),[]),q=["CONNECTING","OPEN","CLOSING","CLOSED"],z=E()("".concat(I,"/socket"),W),H=Object(l.a)(z,3),Q=H[0],X=H[1],Y=H[2],Z=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Q(JSON.stringify(Object(s.a)({},t,{type:e})))}),[Q]);Object(a.useEffect)((function(){X||"OPEN"!==q[Y]||Z("LoadMessages")}),[Y,X,q,Z]),Object(a.useEffect)((function(){if(X){var e=JSON.parse(X.data);switch(e.type){case"Message":c((function(t){return Object(s.a)({},t,Object(u.a)({},e.id,e))}));break;case"VideoFrame":L((function(t){return Object(s.a)({},t,Object(u.a)({},e.sessionId,e))}))}}}),[X]),Object(a.useEffect)((function(){G?x||navigator.mediaDevices.getUserMedia({audio:!1,video:{noiseSuppression:!0}}).then(F).catch((function(e){"ConstraintNotSatisfiedError"===e.name?T((function(e){return[].concat(Object(i.a)(e),["The resolution x px is not supported by your device."])})):"PermissionDeniedError"===e.name&&T((function(e){return[].concat(Object(i.a)(e),["Permissions have not been granted to use your camera and microphone, you need to allow the page access to your devices in order for the demo to work."])})),T((function(t){return[].concat(Object(i.a)(t),["getUserMedia error: "+e.name])}))})):x&&(x.getTracks().forEach((function(e){return e.stop()})),F(void 0),T([]))}),[G,x]);var $=function(){var e;"OPEN"===q[Y]&&"live"===(null===x||void 0===x||null===(e=x.getVideoTracks()[0])||void 0===e?void 0:e.readyState)&&new ImageCapture(x.getVideoTracks()[0]).takePhoto().then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){Z("SendSnapshot",{sessionId:B,frame:t.result,user:y})}}))},_=Object(a.useCallback)($,[q,Y,x]);Object(a.useEffect)((function(){if(G){var e=setInterval((function(){return _()}),1e3);return function(){clearTimeout(e)}}}),[G,_]);var ee=function(){f.trim()&&function(e,t){return Promise.resolve(Z("AddMessage",{message:e,user:t}))}(f.trim(),y).then((function(){return j("")}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{container:!0},r.a.createElement(m.a,{container:!0,item:!0,lg:10},Object.values(J).map((function(e){return r.a.createElement(m.a,{key:e.sessionId,item:!0},r.a.createElement(w,{frame:e}))}))),r.a.createElement(m.a,{item:!0,lg:2},r.a.createElement("div",null,"Websocket is ",q[Y]),r.a.createElement(b.a,{variant:"contained",onClick:function(){return K((function(e){return!e}))}},"Toggle video (",G?"On":"Off",")"),r.a.createElement(b.a,{variant:"contained",onClick:$},"Send snapshot"),r.a.createElement("ul",null,A.map((function(e){return r.a.createElement("li",null,e)}))),r.a.createElement(O.a,{variant:"filled",label:"User",autoFocus:!0,value:y,onChange:function(e){localStorage.setItem("username",e.target.value),k(e.target.value)}}),r.a.createElement(O.a,{variant:"filled",label:"Type your message",autoFocus:!0,value:f,onChange:function(e){return j(e.target.value)},onKeyUp:function(e){e.ctrlKey&&e.key&&ee()}}),r.a.createElement(b.a,{variant:"contained",onClick:ee},"Send Message (ctrl+\u23ce)"),r.a.createElement(v.a,null,Object.values(n).sort((function(e,t){return e.createdAt>t.createdAt?1:e.createdAt<t.createdAt?-1:0})).map((function(e){return r.a.createElement(g.a,{key:e.createdAt},e.createdAt.slice(11,19)," [",e.user,"]: ",e.message)}))))))}),null),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.f73e9ec7.chunk.js.map